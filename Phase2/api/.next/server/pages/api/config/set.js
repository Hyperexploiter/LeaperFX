"use strict";(()=>{var e={};e.id=517,e.ids=[517],e.modules={1495:e=>{e.exports=require("ioredis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4580:e=>{e.exports=require("node-cache")},298:e=>{e.exports=require("rate-limiter-flexible")},1467:e=>{e.exports=import("@vercel/kv")},6555:e=>{e.exports=import("uuid")},8260:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>m});var s=r(1802),a=r(7153),n=r(6249),o=r(7678),u=e([o]);o=(u.then?(await u)():u)[0];let l=(0,n.l)(o,"default"),c=(0,n.l)(o,"config"),m=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/config/set",pathname:"/api/config/set",bundlePath:"",filename:""},userland:o});i()}catch(e){i(e)}})},7234:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{qQ:()=>u});var s=r(298),a=r(8008),n=e([a]);a=(n.then?(await n)():n)[0];class o{constructor(){this.limiters=new Map,this.isRedisAvailable=!!(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN),this.initializeDefaultLimiters()}static getInstance(){return o.instance||(o.instance=new o),o.instance}initializeDefaultLimiters(){this.createLimiter("api",{windowMs:6e4,maxRequests:parseInt(process.env.RATE_LIMIT_REQUESTS||"1000")}),this.createLimiter("data",{windowMs:6e4,maxRequests:500}),this.createLimiter("config",{windowMs:6e4,maxRequests:100}),this.createLimiter("health",{windowMs:6e4,maxRequests:60}),this.createLimiter("auth",{windowMs:3e5,maxRequests:20}),this.createLimiter("ws",{windowMs:3e5,maxRequests:10}),this.createLimiter("rates",{windowMs:6e4,maxRequests:200}),this.createLimiter("market_data",{windowMs:6e4,maxRequests:1e3})}createLimiter(e,t){let r;let i={keyPrefix:`rl_${e}`,points:t.maxRequests,duration:Math.floor(t.windowMs/1e3),blockDuration:Math.floor(t.windowMs/1e3),skipSuccessfulRequests:t.skipSuccessfulRequests||!1,skipFailedRequests:t.skipFailedRequests||!1};if(this.isRedisAvailable)try{r=new s.RateLimiterRedis({...i,storeClient:this.getRedisClient()})}catch(t){console.warn(`[RateLimit] Redis unavailable for ${e}, falling back to memory:`,t),r=new s.RateLimiterMemory(i)}else r=new s.RateLimiterMemory(i);this.limiters.set(e,r)}getRedisClient(){let e=r(1495);if(process.env.KV_URL)return new e(process.env.KV_URL);if(process.env.UPSTASH_REDIS_REST_URL)return new e({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}});throw Error("No Redis configuration found")}async checkRateLimit(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);try{let e=await r.consume(i);return{limit:r.points,remaining:e.remainingPoints||0,reset:Date.now()+(e.msBeforeNext||0)}}catch(e){return{limit:r.points,remaining:0,reset:Date.now()+(e.msBeforeNext||0),retryAfter:Math.round((e.msBeforeNext||0)/1e3)}}}async applyRateLimit(e,t,r="api"){try{let i=await this.checkRateLimit(e,r);if(t.setHeader("X-RateLimit-Limit",i.limit.toString()),t.setHeader("X-RateLimit-Remaining",i.remaining.toString()),t.setHeader("X-RateLimit-Reset",i.reset.toString()),i.retryAfter)return t.setHeader("Retry-After",i.retryAfter.toString()),t.status(429).json({success:!1,error:"Rate limit exceeded",code:"RATE_LIMIT_EXCEEDED",retryAfter:i.retryAfter,timestamp:Date.now(),requestId:a.t7.generateRequestId()}),!1;return!0}catch(e){return console.error("[RateLimit] Error applying rate limit:",e),!0}}async getRateLimitStatus(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);try{let e=await r.get(i);return{limit:r.points,remaining:e?e.remainingPoints:r.points,reset:Date.now()+(e?e.msBeforeNext:0)}}catch(e){return console.error("[RateLimit] Error getting status:",e),{limit:r.points,remaining:r.points,reset:Date.now()+6e4}}}async resetRateLimit(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);await r.delete(i)}createCustomLimiter(e,t){this.createLimiter(e,t)}getLimiters(){return Array.from(this.limiters.keys())}middleware(e="api"){return async(t,r,i)=>{let s=await this.applyRateLimit(t,r,e);return s&&i&&i(),s}}async checkIPRateLimit(e,t){let r=a.t7.getClientIP(e),i=`ip_rl:${r}`,n=new s.RateLimiterMemory({keyPrefix:"ip_rate_limit",points:t.maxRequests,duration:Math.floor(t.windowMs/1e3),blockDuration:Math.floor(t.windowMs/1e3)});try{let e=await n.consume(i);return{limit:t.maxRequests,remaining:e.remainingPoints||0,reset:Date.now()+(e.msBeforeNext||0)}}catch(e){return{limit:t.maxRequests,remaining:0,reset:Date.now()+(e.msBeforeNext||0),retryAfter:Math.round((e.msBeforeNext||0)/1e3)}}}}let u=o.getInstance();i()}catch(e){i(e)}})},7678:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>m,default:()=>u});var s=r(8008),a=r(7234),n=r(936),o=e([s,a,n]);async function u(e,t){let r=s.t7.createSecurityContext(e);s.t7.setSecurityHeaders(t);let i=s.t7.getCorsHeaders(e.headers.origin);if(Object.entries(i).forEach(([e,r])=>{t.setHeader(e,r)}),"OPTIONS"===e.method){t.status(200).end();return}if(!["POST","PUT"].includes(e.method||"")){t.status(405).json({success:!1,error:"Method not allowed",timestamp:Date.now(),requestId:r.requestId});return}try{let i=await a.qQ.applyRateLimit(e,t,"config");if(!i)return;if(!s.t7.validateApiKey(e)){t.status(401).json({success:!1,error:"Invalid or missing API key",timestamp:Date.now(),requestId:r.requestId});return}let n=s.t7.sanitizeInput(e.body);if(Array.isArray(n)){let e=[],i=[];for(let t of n){let r=l(t);if(r.length>0){i.push(...r);continue}try{let r=await c(t);e.push(r)}catch(e){i.push({field:t.key,message:e instanceof Error?e.message:"Update failed",value:t.value})}}if(i.length>0){t.status(400).json({success:!1,error:"Validation errors occurred",details:i,timestamp:Date.now(),requestId:r.requestId});return}t.status(200).json({success:!0,data:e,timestamp:Date.now(),requestId:r.requestId});return}let o=l(n);if(o.length>0){t.status(400).json({success:!1,error:"Validation failed",details:o,timestamp:Date.now(),requestId:r.requestId});return}let u=await c(n);t.status(200).json({success:!0,data:u,timestamp:Date.now(),requestId:r.requestId})}catch(e){console.error("[Config] Set error:",e),t.status(500).json({success:!1,error:"Internal server error",timestamp:Date.now(),requestId:r.requestId})}}function l(e){let t=[];return e&&"object"==typeof e?(e.key&&"string"==typeof e.key||t.push({field:"key",message:"Key is required and must be a string",value:e.key}),(void 0===e.value||null===e.value)&&t.push({field:"value",message:"Value is required",value:e.value}),e.key&&!/^[a-zA-Z0-9._-]+$/.test(e.key)&&t.push({field:"key",message:"Key can only contain letters, numbers, dots, underscores, and hyphens",value:e.key}),e.category&&"string"!=typeof e.category&&t.push({field:"category",message:"Category must be a string",value:e.category}),e.description&&"string"!=typeof e.description&&t.push({field:"description",message:"Description must be a string",value:e.description})):t.push({field:"root",message:"Request body must be an object",value:e}),t}async function c(e){let t=Date.now(),r=await n.Fs.getConfiguration(e.key),i={key:e.key,value:e.value,type:function(e){if(Array.isArray(e))return"array";if(null===e)return"object";let t=typeof e;return t}(e.value),category:e.category||r?.category||"general",description:e.description||r?.description,lastModified:t,version:(r?.version||0)+1};(function(e){switch(e.category){case"timing":(function(e){if(e.key.includes("interval")&&"number"==typeof e.value&&(e.value<100||e.value>6e4))throw Error("Timing intervals must be between 100ms and 60000ms")})(e);break;case"display":(function(e){if(e.key.includes("size")&&"number"==typeof e.value&&(e.value<1||e.value>100))throw Error("Display sizes must be between 1 and 100")})(e);break;case"colors":(function(e){if(e.key.includes("color")&&"string"==typeof e.value&&!/^#[0-9A-Fa-f]{6}$/.test(e.value))throw Error("Colors must be valid hex codes (e.g., #FF0000)")})(e);break;case"performance":(function(e){if(e.key.includes("fps")&&"number"==typeof e.value&&(e.value<1||e.value>144))throw Error("FPS must be between 1 and 144")})(e);break;case"providers":(function(e){if(e.key.includes("provider")&&"string"==typeof e.value){let t=["polygon","twelvedata","coinbase","boc"];if(!t.includes(e.value))throw Error(`Provider must be one of: ${t.join(", ")}`)}})(e)}})(i);let s=await n.Fs.setConfiguration(i);if(!s)throw Error("Failed to save configuration");return i}[s,a,n]=o.then?(await o)():o;let m={api:{responseLimit:"8mb"}};i()}catch(e){i(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[924],()=>r(8260));module.exports=i})();