"use strict";(()=>{var e={};e.id=443,e.ids=[443],e.modules={1495:e=>{e.exports=require("ioredis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4580:e=>{e.exports=require("node-cache")},298:e=>{e.exports=require("rate-limiter-flexible")},1467:e=>{e.exports=import("@vercel/kv")},6555:e=>{e.exports=import("uuid")},548:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>u,routeModule:()=>l});var s=r(1802),a=r(7153),n=r(6249),o=r(2290),m=e([o]);o=(m.then?(await m)():m)[0];let u=(0,n.l)(o,"default"),c=(0,n.l)(o,"config"),l=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/config/get",pathname:"/api/config/get",bundlePath:"",filename:""},userland:o});i()}catch(e){i(e)}})},7234:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{qQ:()=>m});var s=r(298),a=r(8008),n=e([a]);a=(n.then?(await n)():n)[0];class o{constructor(){this.limiters=new Map,this.isRedisAvailable=!!(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN),this.initializeDefaultLimiters()}static getInstance(){return o.instance||(o.instance=new o),o.instance}initializeDefaultLimiters(){this.createLimiter("api",{windowMs:6e4,maxRequests:parseInt(process.env.RATE_LIMIT_REQUESTS||"1000")}),this.createLimiter("data",{windowMs:6e4,maxRequests:500}),this.createLimiter("config",{windowMs:6e4,maxRequests:100}),this.createLimiter("health",{windowMs:6e4,maxRequests:60}),this.createLimiter("auth",{windowMs:3e5,maxRequests:20}),this.createLimiter("ws",{windowMs:3e5,maxRequests:10}),this.createLimiter("rates",{windowMs:6e4,maxRequests:200}),this.createLimiter("market_data",{windowMs:6e4,maxRequests:1e3})}createLimiter(e,t){let r;let i={keyPrefix:`rl_${e}`,points:t.maxRequests,duration:Math.floor(t.windowMs/1e3),blockDuration:Math.floor(t.windowMs/1e3),skipSuccessfulRequests:t.skipSuccessfulRequests||!1,skipFailedRequests:t.skipFailedRequests||!1};if(this.isRedisAvailable)try{r=new s.RateLimiterRedis({...i,storeClient:this.getRedisClient()})}catch(t){console.warn(`[RateLimit] Redis unavailable for ${e}, falling back to memory:`,t),r=new s.RateLimiterMemory(i)}else r=new s.RateLimiterMemory(i);this.limiters.set(e,r)}getRedisClient(){let e=r(1495);if(process.env.KV_URL)return new e(process.env.KV_URL);if(process.env.UPSTASH_REDIS_REST_URL)return new e({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}});throw Error("No Redis configuration found")}async checkRateLimit(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);try{let e=await r.consume(i);return{limit:r.points,remaining:e.remainingPoints||0,reset:Date.now()+(e.msBeforeNext||0)}}catch(e){return{limit:r.points,remaining:0,reset:Date.now()+(e.msBeforeNext||0),retryAfter:Math.round((e.msBeforeNext||0)/1e3)}}}async applyRateLimit(e,t,r="api"){try{let i=await this.checkRateLimit(e,r);if(t.setHeader("X-RateLimit-Limit",i.limit.toString()),t.setHeader("X-RateLimit-Remaining",i.remaining.toString()),t.setHeader("X-RateLimit-Reset",i.reset.toString()),i.retryAfter)return t.setHeader("Retry-After",i.retryAfter.toString()),t.status(429).json({success:!1,error:"Rate limit exceeded",code:"RATE_LIMIT_EXCEEDED",retryAfter:i.retryAfter,timestamp:Date.now(),requestId:a.t7.generateRequestId()}),!1;return!0}catch(e){return console.error("[RateLimit] Error applying rate limit:",e),!0}}async getRateLimitStatus(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);try{let e=await r.get(i);return{limit:r.points,remaining:e?e.remainingPoints:r.points,reset:Date.now()+(e?e.msBeforeNext:0)}}catch(e){return console.error("[RateLimit] Error getting status:",e),{limit:r.points,remaining:r.points,reset:Date.now()+6e4}}}async resetRateLimit(e,t="api"){let r=this.limiters.get(t);if(!r)throw Error(`Rate limiter not found for category: ${t}`);let i=a.t7.getRateLimitKey(e,t);await r.delete(i)}createCustomLimiter(e,t){this.createLimiter(e,t)}getLimiters(){return Array.from(this.limiters.keys())}middleware(e="api"){return async(t,r,i)=>{let s=await this.applyRateLimit(t,r,e);return s&&i&&i(),s}}async checkIPRateLimit(e,t){let r=a.t7.getClientIP(e),i=`ip_rl:${r}`,n=new s.RateLimiterMemory({keyPrefix:"ip_rate_limit",points:t.maxRequests,duration:Math.floor(t.windowMs/1e3),blockDuration:Math.floor(t.windowMs/1e3)});try{let e=await n.consume(i);return{limit:t.maxRequests,remaining:e.remainingPoints||0,reset:Date.now()+(e.msBeforeNext||0)}}catch(e){return{limit:t.maxRequests,remaining:0,reset:Date.now()+(e.msBeforeNext||0),retryAfter:Math.round((e.msBeforeNext||0)/1e3)}}}}let m=o.getInstance();i()}catch(e){i(e)}})},2290:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>m});var s=r(8008),a=r(7234),n=r(936),o=e([s,a,n]);async function m(e,t){let r=s.t7.createSecurityContext(e);s.t7.setSecurityHeaders(t);let i=s.t7.getCorsHeaders(e.headers.origin);if(Object.entries(i).forEach(([e,r])=>{t.setHeader(e,r)}),"OPTIONS"===e.method){t.status(200).end();return}if("GET"!==e.method){t.status(405).json({success:!1,error:"Method not allowed",timestamp:Date.now(),requestId:r.requestId});return}try{let i=await a.qQ.applyRateLimit(e,t,"config");if(!i)return;if(!s.t7.validateApiKey(e)){t.status(401).json({success:!1,error:"Invalid or missing API key",timestamp:Date.now(),requestId:r.requestId});return}let{key:o,category:m,keys:u}=s.t7.sanitizeInput(e.query);if(u){let e=Array.isArray(u)?u:u.split(","),i=[];for(let t of e){let e=await n.Fs.getConfiguration(t);e&&i.push(e)}t.status(200).json({success:!0,data:i,timestamp:Date.now(),requestId:r.requestId});return}if(o){let e=await n.Fs.getConfiguration(o);if(!e){t.status(404).json({success:!1,error:`Configuration not found: ${o}`,timestamp:Date.now(),requestId:r.requestId});return}t.status(200).json({success:!0,data:e,timestamp:Date.now(),requestId:r.requestId});return}let c=await n.Fs.getAllConfigurations();m&&(c=c.filter(e=>e.category===m)),c.sort((e,t)=>e.category!==t.category?e.category.localeCompare(t.category):e.key.localeCompare(t.key)),t.status(200).json({success:!0,data:c,timestamp:Date.now(),requestId:r.requestId})}catch(e){console.error("[Config] Get error:",e),t.status(500).json({success:!1,error:"Internal server error",timestamp:Date.now(),requestId:r.requestId})}}[s,a,n]=o.then?(await o)():o;let u={api:{responseLimit:"8mb"}};i()}catch(e){i(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[924],()=>r(548));module.exports=i})();