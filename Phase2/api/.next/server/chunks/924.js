"use strict";exports.id=924,exports.ids=[924],exports.modules={6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},936:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Fs:()=>l});var a=r(1467),n=r(4580),i=r.n(n),o=e([a]);a=(o.then?(await o)():o)[0];class c{constructor(){this.memoryCache=new(i())({stdTTL:300,checkperiod:60,useClones:!1}),this.isKVAvailable=!!(process.env.KV_URL||process.env.KV_REST_API_URL),this.isRedisAvailable=!!(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN),console.log("[Database] KV Available:",this.isKVAvailable),console.log("[Database] Redis Available:",this.isRedisAvailable)}static getInstance(){return c.instance||(c.instance=new c),c.instance}async get(e){try{if(this.isKVAvailable)try{let t=await a.kv.get(e);if(null!==t)return t}catch(e){console.warn("[Database] KV get error:",e)}if(this.isRedisAvailable)try{let t=r(1495),s=new t({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}}),a=await s.get(e);if(await s.quit(),a)return JSON.parse(a)}catch(e){console.warn("[Database] Redis get error:",e)}return this.memoryCache.get(e)||null}catch(e){return console.error("[Database] Get error:",e),null}}async set(e,t,s){try{if(this.isKVAvailable)try{return s?await a.kv.setex(e,s,t):await a.kv.set(e,t),!0}catch(e){console.warn("[Database] KV set error:",e)}if(this.isRedisAvailable)try{let a=r(1495),n=new a({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}}),i=JSON.stringify(t);return s?await n.setex(e,s,i):await n.set(e,i),await n.quit(),!0}catch(e){console.warn("[Database] Redis set error:",e)}return s?this.memoryCache.set(e,t,s):this.memoryCache.set(e,t),!0}catch(e){return console.error("[Database] Set error:",e),!1}}async delete(e){try{if(this.isKVAvailable)try{await a.kv.del(e)}catch(e){console.warn("[Database] KV delete error:",e)}if(this.isRedisAvailable)try{let t=r(1495),s=new t({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}});await s.del(e),await s.quit()}catch(e){console.warn("[Database] Redis delete error:",e)}return this.memoryCache.del(e),!0}catch(e){return console.error("[Database] Delete error:",e),!1}}async exists(e){try{if(this.isKVAvailable)try{let t=await a.kv.get(e);if(null!==t)return!0}catch(e){console.warn("[Database] KV exists error:",e)}if(this.isRedisAvailable)try{let t=r(1495),s=new t({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}}),a=await s.exists(e);if(await s.quit(),a)return!0}catch(e){console.warn("[Database] Redis exists error:",e)}return this.memoryCache.has(e)}catch(e){return console.error("[Database] Exists error:",e),!1}}async keys(e){try{let t=new Set;if(this.isKVAvailable,this.isRedisAvailable)try{let s=r(1495),a=new s({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}}),n=await a.keys(e);n.forEach(e=>t.add(e)),await a.quit()}catch(e){console.warn("[Database] Redis keys error:",e)}let s=this.memoryCache.keys(),a=new RegExp(e.replace(/\*/g,".*").replace(/\?/g,"."));return s.forEach(e=>{a.test(e)&&t.add(e)}),Array.from(t)}catch(e){return console.error("[Database] Keys error:",e),[]}}async increment(e,t=1){try{if(this.isKVAvailable)try{return await a.kv.incr(e)}catch(e){console.warn("[Database] KV increment error:",e)}if(this.isRedisAvailable)try{let s=r(1495),a=new s({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}}),n=await a.incrby(e,t);return await a.quit(),n}catch(e){console.warn("[Database] Redis increment error:",e)}let s=this.memoryCache.get(e)||0,n=s+t;return this.memoryCache.set(e,n),n}catch(e){return console.error("[Database] Increment error:",e),0}}async setex(e,t,r){return this.set(e,r,t)}async hset(e,t,r){try{let s=await this.get(e)||{};return s[t]=r,this.set(e,s)}catch(e){return console.error("[Database] Hash set error:",e),!1}}async hget(e,t){try{let r=await this.get(e);return r?r[t]:null}catch(e){return console.error("[Database] Hash get error:",e),null}}async hgetall(e){try{return await this.get(e)}catch(e){return console.error("[Database] Hash get all error:",e),null}}async lpush(e,t){try{let r=await this.get(e)||[];return r.unshift(t),await this.set(e,r),r.length}catch(e){return console.error("[Database] List push error:",e),0}}async lrange(e,t,r){try{let s=await this.get(e)||[];return s.slice(t,-1===r?void 0:r+1)}catch(e){return console.error("[Database] List range error:",e),[]}}async getConfiguration(e){return this.get(`config:${e}`)}async setConfiguration(e){return this.set(`config:${e.key}`,e)}async getAllConfigurations(){try{let e=await this.keys("config:*"),t=[];for(let r of e){let e=await this.get(r);e&&t.push(e)}return t}catch(e){return console.error("[Database] Get all configurations error:",e),[]}}async getProfile(e){return this.get(`profile:${e}`)}async setProfile(e){return this.set(`profile:${e.id}`,e)}async getAllProfiles(){try{let e=await this.keys("profile:*"),t=[];for(let r of e){let e=await this.get(r);e&&t.push(e)}return t}catch(e){return console.error("[Database] Get all profiles error:",e),[]}}async healthCheck(){let e={memory:!0,kv:!1,redis:!1},t=1;if(this.isKVAvailable)try{await a.kv.set("health_check",Date.now()),await a.kv.get("health_check"),e.kv=!0,t++}catch(t){e.kvError=t instanceof Error?t.message:"Unknown error"}if(this.isRedisAvailable)try{let s=r(1495),a=new s({host:new URL(process.env.UPSTASH_REDIS_REST_URL).hostname,port:parseInt(new URL(process.env.UPSTASH_REDIS_REST_URL).port)||6379,password:process.env.UPSTASH_REDIS_REST_TOKEN,tls:{}});await a.set("health_check",Date.now()),await a.get("health_check"),await a.quit(),e.redis=!0,t++}catch(t){e.redisError=t instanceof Error?t.message:"Unknown error"}let s=1+(this.isKVAvailable?1:0)+(this.isRedisAvailable?1:0),n=t===s?"healthy":t>0?"degraded":"unhealthy";return{status:n,details:e}}}let l=c.getInstance();s()}catch(e){s(e)}})},8008:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{t7:()=>o});var a=r(6555),n=e([a]);a=(n.then?(await n)():n)[0];class i{constructor(){this.secretKey=process.env.API_SECRET_KEY||"fallback-dev-key-change-in-production"}static getInstance(){return i.instance||(i.instance=new i),i.instance}generateRequestId(){return(0,a.v4)()}getClientIP(e){let t=e.headers["x-forwarded-for"],r=e.headers["x-real-ip"],s=e.headers["cf-connecting-ip"];return"string"==typeof t?t.split(",")[0].trim():"string"==typeof r?r:"string"==typeof s?s:e.socket.remoteAddress||"unknown"}createSecurityContext(e){return{requestId:this.generateRequestId(),clientId:e.headers["x-client-id"],ipAddress:this.getClientIP(e),userAgent:e.headers["user-agent"]||"unknown",timestamp:Date.now(),rateLimitInfo:{limit:1e3,remaining:999,reset:Date.now()+6e4}}}validateApiKey(e){let t=e.headers["x-api-key"]||e.headers.authorization?.replace("Bearer ","");return!!t&&(t===this.secretKey||t===process.env.API_SECRET_KEY)}sanitizeInput(e){if("string"==typeof e)return e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim();if(Array.isArray(e))return e.map(e=>this.sanitizeInput(e));if("object"==typeof e&&null!==e){let t={};for(let[r,s]of Object.entries(e))t[this.sanitizeInput(r)]=this.sanitizeInput(s);return t}return e}validateRequest(e,t){let r=[],s={...e.query,...e.body};for(let[e,a]of Object.entries(t)){let t=s[e];if(a.required&&(null==t||""===t)){r.push({field:e,message:`${e} is required`,value:t});continue}if(void 0!==t&&a.type){let s=Array.isArray(t)?"array":typeof t;s!==a.type&&r.push({field:e,message:`${e} must be of type ${a.type}`,value:t})}a.minLength&&"string"==typeof t&&t.length<a.minLength&&r.push({field:e,message:`${e} must be at least ${a.minLength} characters`,value:t}),a.maxLength&&"string"==typeof t&&t.length>a.maxLength&&r.push({field:e,message:`${e} must be no more than ${a.maxLength} characters`,value:t}),a.pattern&&"string"==typeof t&&!a.pattern.test(t)&&r.push({field:e,message:`${e} format is invalid`,value:t}),a.enum&&!a.enum.includes(t)&&r.push({field:e,message:`${e} must be one of: ${a.enum.join(", ")}`,value:t})}return r}setSecurityHeaders(e){e.setHeader("X-Content-Type-Options","nosniff"),e.setHeader("X-Frame-Options","DENY"),e.setHeader("X-XSS-Protection","1; mode=block"),e.setHeader("Referrer-Policy","strict-origin-when-cross-origin"),e.setHeader("Content-Security-Policy","default-src 'self'"),e.setHeader("Strict-Transport-Security","max-age=31536000; includeSubDomains")}isOriginAllowed(e){if(!e)return!0;let t=["http://localhost:3000","http://localhost:5173","https://leaperfx-dashboard.vercel.app",process.env.CORS_ORIGIN].filter(Boolean);return t.includes(e)}getCorsHeaders(e){let t=this.isOriginAllowed(e);return{"Access-Control-Allow-Origin":t?e||"*":"null","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-API-Key, X-Request-ID, X-Client-ID","Access-Control-Max-Age":"86400",Vary:"Origin"}}getRateLimitKey(e,t="rl"){let r=this.getClientIP(e),s=e.headers["x-api-key"]||"anonymous";return`${t}:${r}:${s}`}isSuspiciousRequest(e){let t=e.headers["user-agent"]||"";return![/googlebot/i,/bingbot/i,/slackbot/i,/facebookexternalhit/i,/twitterbot/i,/linkedinbot/i,/chrome/i,/firefox/i,/safari/i,/edge/i].some(e=>e.test(t))&&[/bot/i,/crawler/i,/spider/i,/scraper/i,/curl/i,/wget/i,/python/i,/postman/i].some(e=>e.test(t))}logSecurityEvent(e,t,r){let s={timestamp:new Date().toISOString(),event:e,requestId:t.requestId,ip:t.ipAddress,userAgent:t.userAgent,details:r};console.log("[SECURITY]",JSON.stringify(s))}}let o=i.getInstance();s()}catch(e){s(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};